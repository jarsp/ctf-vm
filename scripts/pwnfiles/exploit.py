from pwn import *

import sys
from pwn_docker import *

###### FILL IN! ######
# Container name
CONT=
# Path to executable in docker
DOCKER_EXE='/tmp/mnt/'
# Path to executable locally
EXE=
# Preloads
PRELOAD=
######################

# Use this instead of gdb.attach()
gdb_attach = gdb.attach



def exploit(r):
    pass



if __name__ == '__main__':
    if PRELOAD is not None:
        env = {'LD_PRELOAD', PRELOAD}
    else:
        env = None

    is_docker = False
    if len(sys.argv) == 3:
        r = remote(sys.argv[1], int(sys.argv[2]))
    elif len(sys.argv) == 2 and sys.argv[1] == 'd':
        is_docker = True
        r = process_d(CONT, EXE, env)
    else:
        r = process(EXE, env=env)

    if is_docker:
        info = pre_exploit_d(CONT, EXE)
        gdb_attach = make_gdb_attach_d(CONT, info)
    try:
        exploit(r)
    finally:
        if is_docker:
            post_exploit_d(cont, info)
