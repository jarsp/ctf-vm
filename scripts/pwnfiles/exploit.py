from pwn import *

import os
import sys
from pwn_docker import *

###### FILL IN! ######
# Container name
CONT=''
# Path to mount in docker
DOCKER_DIR='/tmp/mnt'
# Path to executable locally
EXE=''
DOCKER_EXE=os.path.join(DOCKER_DIR, EXE)
# Preloads
PRELOAD=''
DOCKER_PRELOAD=''
######################




# use gdb_attach instead of gdb.attach
def exploit(r_):
    r, gdb_attach = r_()
    gdb_attach(r)
    r.interactive()



if __name__ == '__main__':
    DPRELOAD_ = ' '.join(map(lambda x: os.path.join(DOCKER_DIR, x), DOCKER_PRELOAD.split()))
    params = {'cont': CONT,
              'exe': EXE,
              'docker_exe': DOCKER_EXE,
              'preload': {'LD_PRELOAD': PRELOAD} if PRELOAD != '' else None,
              'docker_preload': {'LD_PRELOAD': DPRELOAD_} if DPRELOAD_ != '' else None}

    if len(sys.argv) == 3:
        params['type'] = 'remote'
        params['host'] = sys.argv[1]
        params['port'] = int(sys.argv[2])
    elif len(sys.argv) == 2 and sys.argv[1] == 'd':
        params['type'] = 'docker'
    else:
        params['type'] = 'local'

    run_exploit(params, exploit)
